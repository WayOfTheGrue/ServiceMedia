<!DOCTYPE html>
<html>
<head>
<title>s3up</title>
<meta charset="utf-8"/>
<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script>
// Remember to include jQuery somewhere.

$(function() {

  $('#theForm').on('submit', s3up);

});

function s3up (e) {
    
    e.preventDefault();
    
    var file = $('#theFile').get()[0].files[0];
    var fname = $('input[type=file]').val().replace(/.*(\/|\\)/, '');
    fname = encodeURI(fname);
    var timeInMs = Date.now();
    fname = timeInMs + "." + fname;
	// var fname = "video_" + timeInMs + ".mp4";
	$.ajax({
    headers: {
	    "Access-Control-Allow-Origin": "*"
    },		
    url: 'http://192.168.1.198:3000/putobjecturl',
        type: 'POST',
        data: {filename: fname, size: file.size, contentType:file.type},
        success: (function(res){
            console.log(res);
            $('#uploadedlink').html( "uploading file...");
            var x = $.ajax({
                headers: {
                        "Access-Control-Allow-Origin": "*"
                },
                beforeSend: function(xhrObj){
                    xhrObj.setRequestHeader("Content-Type", file.type);
                    xhrObj.setRequestHeader("Access-Control-Allow-Origin","*");
                },
                origin: "http://192.168.1.198:3000",
                url: res,
                type: 'PUT',
                data: file,
                processData: false,
                contentType: file.type,
                crossDomain: true,

                success: (function(res){
                    console.log('Done');
                    var vidurl = "http://3dcasefiles.com/braincheck/" + fname;
                    $('#uploadedlink').html( "<a href=" + vidurl + ">" + fname + "</a>");
                })
            })
            console.log(x);
        })
	});	
}
</script>
</head>

<body>
Test upload to S3 bucket
<form id="theForm" method="POST">
    <input id="theFile" name="file" type="file"/> 
    <button id="theButton" type="submit">Send</button>
</form>
<div id="uploadedlink">

</div>
</body>

</html>